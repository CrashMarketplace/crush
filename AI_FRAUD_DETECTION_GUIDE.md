# AI 사기 위험 분석 엔진 가이드

## 개요

BILIDA의 AI 사기 위험 분석 엔진은 등록된 상품과 판매자를 자동으로 분석하여 잠재적인 사기 위험을 감지하고 사용자에게 경고합니다.

## 주요 기능

### 1. 다차원 위험도 분석

AI 엔진은 다음 5가지 요소를 종합적으로 분석합니다:

#### 📅 계정 나이 (가중치 15%)
- 신규 계정 (7일 미만): 높은 위험
- 최근 가입 (30일 미만): 중간 위험
- 일반 계정 (90일 미만): 낮은 위험
- 신뢰 계정 (90일 이상): 안전

#### 📊 거래 이력 (가중치 25%)
- 완료된 거래 수
- 예약 취소율
- 거래 패턴 분석

#### 💰 가격 분석 (가중치 30%)
- 카테고리별 시세 대비 가격 비교
- 시세보다 70% 이상 저렴: 매우 의심
- 시세보다 50-70% 저렴: 의심
- 시세보다 30-50% 저렴: 합리적 할인
- 적정 가격대: 안전

#### ⭐ 리뷰 패턴 (가중치 20%)
- 부정 리뷰 비율
- 위험 키워드 감지:
  - "노쇼", "입금", "선입금"
  - "말 바꿈", "연락두절", "사기"
  - "환불거부", "거짓말", "불친절"
  - "위협", "욕설"

#### 🎯 행동 패턴 (가중치 10%)
- 24시간 내 상품 등록 수
- 매너 온도
- 신뢰 지수
- 활동 패턴

### 2. 위험도 점수 (0-100점)

각 요소의 점수를 가중 평균하여 종합 위험도를 계산합니다:

```
위험도 = (계정나이 × 0.15) + (거래이력 × 0.25) + (가격분석 × 0.30) + 
         (리뷰패턴 × 0.20) + (행동패턴 × 0.10)
```

### 3. 위험 레벨

- **낮음** (0-29점): ✅ 비교적 안전한 거래
- **보통** (30-59점): ⚡ 주의 필요
- **높음** (60-100점): ⚠️ 각별한 주의 필요

## API 엔드포인트

### 상품 분석

```http
GET /api/fraud-detection/analyze/:productId?sellerId={sellerId}
Authorization: Bearer {token}
```

**응답 예시:**

```json
{
  "riskScore": 65,
  "riskLevel": "높음",
  "riskFactors": [
    "신규 계정 (가입 3일)",
    "이전 거래 없음",
    "시세보다 60% 저렴"
  ],
  "recommendation": "⚠️ 거래 시 각별한 주의가 필요합니다. 반드시 대면 거래를 권장하며, 선입금은 절대 피하세요.",
  "reasoning": {
    "accountAge": {
      "score": 80,
      "description": "신규 계정 (가입 3일)"
    },
    "transactionHistory": {
      "score": 70,
      "description": "이전 거래 없음"
    },
    "priceAnalysis": {
      "score": 70,
      "description": "시세보다 60% 저렴"
    },
    "reviewPattern": {
      "score": 30,
      "description": "리뷰 없음"
    },
    "behaviorPattern": {
      "score": 0,
      "description": "정상 활동 패턴"
    }
  }
}
```

## 사용 방법

### 1. 상품 상세 페이지

구매자가 상품을 볼 때 자동으로 AI 분석 결과가 표시됩니다:

```tsx
import FraudRiskBadge from "../components/FraudRiskBadge";

<FraudRiskBadge productId={product._id} sellerId={sellerId} />
```

### 2. 관리자 대시보드

관리자는 전체 상품의 위험도를 한눈에 확인할 수 있습니다:

1. 관리자 페이지 접속
2. "🔍 AI 사기 위험 분석" 버튼 클릭
3. `/admin/fraud-analytics` 페이지에서 확인

**기능:**
- 전체 상품 통계 (전체/분석완료/높음/보통/낮음)
- 개별 상품 분석
- 전체 상품 일괄 분석
- 위험도별 필터링

### 3. 컴팩트 모드

간단한 배지 형태로 표시:

```tsx
<FraudRiskBadge 
  productId={product._id} 
  sellerId={sellerId} 
  compact={true} 
/>
```

## 권장사항 시스템

AI는 위험도에 따라 자동으로 권장사항을 생성합니다:

### 높음 (60점 이상)
```
⚠️ 거래 시 각별한 주의가 필요합니다. 
반드시 대면 거래를 권장하며, 선입금은 절대 피하세요. 
상품 상태를 직접 확인한 후 거래하시기 바랍니다.
```

### 보통 (30-59점)
```
⚡ 거래 전 판매자와 충분히 소통하고, 
가능하면 대면 거래를 권장합니다. 
상품 상태와 가격을 꼼꼼히 확인하세요.
```

### 낮음 (0-29점)
```
✅ 비교적 안전한 거래로 판단됩니다. 
그래도 거래 시 기본적인 주의사항을 지켜주세요.
```

## 카테고리별 평균 시세

현재 설정된 카테고리별 기준 시세:

| 카테고리 | 평균 시세 |
|---------|----------|
| 전자기기 | 300,000원 |
| 가구/인테리어 | 150,000원 |
| 의류 | 30,000원 |
| 도서 | 10,000원 |
| 스포츠/레저 | 80,000원 |
| 생활용품 | 20,000원 |
| 기타 | 50,000원 |

> **참고:** 실제 운영 시에는 DB에서 실시간 통계를 계산하여 더 정확한 시세를 반영할 수 있습니다.

## 설정 및 커스터마이징

### 위험 키워드 추가

`server/src/services/fraudDetection.ts` 파일에서 키워드를 추가/수정할 수 있습니다:

```typescript
const RISK_KEYWORDS = [
  "노쇼", "입금", "선입금", "말 바꿈", "연락두절", "사기",
  "환불거부", "거짓말", "불친절", "위협", "욕설",
  // 추가 키워드...
];
```

### 가중치 조정

각 요소의 중요도를 조정할 수 있습니다:

```typescript
const weights = {
  accountAge: 0.15,      // 계정 나이
  transaction: 0.25,     // 거래 이력
  price: 0.30,           // 가격 분석
  review: 0.20,          // 리뷰 패턴
  behavior: 0.10,        // 행동 패턴
};
```

### 위험도 임계값 조정

```typescript
if (riskScore < 30) riskLevel = "낮음";
else if (riskScore < 60) riskLevel = "보통";
else riskLevel = "높음";
```

## 주의사항

### 1. 과도한 공포 유발 금지
- AI 분석은 참고용이며, 최종 판단은 사용자의 몫입니다
- 객관적인 근거 기반으로만 경고를 제공합니다

### 2. 설명 가능성 (Explainable AI)
- 모든 위험 점수는 구체적인 근거와 함께 제공됩니다
- 사용자는 각 요소별 점수와 설명을 확인할 수 있습니다

### 3. 개인정보 보호
- 분석 결과는 해당 상품을 보는 사용자에게만 표시됩니다
- 판매자의 민감한 정보는 노출되지 않습니다

### 4. 지속적인 개선
- 실제 사기 사례 데이터를 수집하여 알고리즘을 개선할 수 있습니다
- 머신러닝 모델을 도입하여 더 정확한 예측이 가능합니다

## 향후 개선 방향

### 1. 머신러닝 모델 도입
- 실제 사기 사례 데이터로 학습
- 더 정확한 패턴 인식

### 2. 실시간 시세 분석
- 크롤링을 통한 실시간 시세 수집
- 카테고리별 세분화된 가격 분석

### 3. 이미지 분석
- 상품 이미지의 진위 여부 확인
- 중복 이미지 감지

### 4. 네트워크 분석
- 연관된 계정 간의 관계 분석
- 조직적 사기 패턴 감지

### 5. 사용자 신고 시스템 연동
- 신고 이력을 분석에 반영
- 커뮤니티 기반 위험도 평가

## 문제 해결

### 분석이 실패하는 경우

1. **인증 오류**
   - 로그인 상태 확인
   - 토큰 유효성 확인

2. **데이터 부족**
   - 신규 상품/판매자의 경우 데이터가 부족할 수 있음
   - 기본값으로 보수적인 분석 제공

3. **서버 오류**
   - 서버 로그 확인
   - MongoDB 연결 상태 확인

## 라이선스 및 책임

이 AI 사기 위험 분석 엔진은 참고용으로만 제공되며, 분석 결과에 대한 법적 책임은 지지 않습니다. 최종 거래 결정은 사용자의 판단에 따라 이루어져야 합니다.

## 문의

AI 사기 위험 분석 엔진에 대한 문의사항이나 개선 제안은 관리자에게 연락해주세요.
